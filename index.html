<script>
function copyText(text){
  const ta=document.createElement("textarea");
  ta.value=text;
  document.body.appendChild(ta);
  ta.select();
  document.execCommand("copy");
  document.body.removeChild(ta);
}

function normalizeName(name){
  return name
    .replace(/['’]/g,"")
    .replace(/\s+/g,"_")
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g,"");
}

const content=document.getElementById("content");

Object.entries(data).forEach(([etape,list])=>{
  const sec=document.createElement("div");
  sec.className="etape";

  const title=document.createElement("h2");
  sec.appendChild(title);

  const grid=document.createElement("div");
  grid.className="list";

  list.forEach((name,i)=>{
    const key=`archi_${etape}_${i}`;
    const row=document.createElement("div");
    row.className="archi";

    const cb=document.createElement("input");
    cb.type="checkbox";
    cb.checked=localStorage.getItem(key)==="1";

    const img=document.createElement("img");
    img.src=`images/archimonstres/${etape}/${normalizeName(name)}.png`;
    img.alt=name;
    img.style.width="32px";
    img.style.height="32px";
    img.style.objectFit="contain";

    const label=document.createElement("span");
    label.textContent=name;

    function update(){
      localStorage.setItem(key,cb.checked?"1":"0");
      row.classList.toggle("checked",cb.checked);
      updateCounter();
    }

    row.onclick=()=>{
      copyText(name);
      cb.checked=true;
      update();
    };

    cb.onclick=(e)=>{
      e.stopPropagation();
      copyText(name);
      update();
    };

    if(cb.checked)row.classList.add("checked");

    row.append(cb,img,label);
    grid.appendChild(row);
  });

  sec.appendChild(grid);
  content.appendChild(sec);

  function updateCounter(){
    const checked=grid.querySelectorAll("input:checked").length;
    title.textContent=`ETAPE ${etape} — ${checked} / ${list.length}`;
  }
  updateCounter();
});
</script>
